# IGK-TodoList 도메인 정의서

## 문서 정보

- **버전**: 2.0
- **최종 수정일**: 2025-11-25
- **상태**: Review Ready
- **검토자**: -
- **승인자**: -

## 변경 이력

| 버전 | 일자       | 변경 내용                                              | 작성자 |
| ---- | ---------- | ------------------------------------------------------ | ------ |
| 1.0  | 2025-11-25 | 초안 작성                                              | Claude |
| 1.1  | 2025-11-25 | 엔티티 속성 상세화, 검증 기준 추가, 문서 메타데이터 추가 | Claude |
| 2.0  | 2025-11-25 | 평가 보고서 기반 개선: 할일 완료 기능 추가, 공통 할일 관리 상세화, 예외 처리 및 테스트 시나리오 추가, 관련 문서 연결, 요구사항 추적 매트릭스 추가 | Claude |

---

## 1. 개요

IGK-TodoList는 사용자 인증 기반의 개인 할일 관리 애플리케이션입니다. 사용자는 자신만의 할일 목록을 생성하고 관리할 수 있으며, 국경일과 같은 공통 일정도 함께 확인할 수 있습니다.

## 2. 핵심 엔티티

### 2.1 User (사용자)

회원가입을 통해 생성되는 애플리케이션 사용자로, 인증을 통해 자신의 할일 목록에 접근합니다.

#### 속성 정의

| 속성명     | 타입     | 필수 | 제약조건            | 기본값 | 설명                  |
| ---------- | -------- | ---- | ------------------- | ------ | --------------------- |
| 사용자ID   | UUID     | O    | PK, Unique          | Auto   | 사용자 고유 식별자 (시스템 자동 생성) |
| 이메일     | String   | O    | Unique, Email 형식  | -      | 로그인 아이디 (이메일 형식 검증, 중복 불가) |
| 비밀번호   | String   | O    | 최소 8자, 암호화 저장 | -    | 사용자 비밀번호 (평문 저장 금지, 해시 암호화 필수) |
| 이름       | String   | O    | 1-50자              | -      | 사용자 실명 또는 닉네임 |
| 가입일시   | DateTime | O    | -                   | Now()  | 회원가입 완료 시간 (시스템 자동 설정) |

#### 참조 관계

- **참조됨**: TodoItem (소유자)

### 2.2 TodoItem (할일)

사용자가 관리하는 개별 할일 항목으로, 개인 할일과 공통 할일로 구분됩니다.

#### 속성 정의

| 속성명     | 타입     | 필수 | 제약조건                 | 기본값 | 설명                                |
| ---------- | -------- | ---- | ------------------------ | ------ | ----------------------------------- |
| 할일ID     | UUID     | O    | PK, Unique               | Auto   | 할일 고유 식별자                    |
| 제목       | String   | O    | 1-200자                  | -      | 할일 제목                           |
| 내용       | Text     | X    | 0-2000자                 | NULL   | 할일 상세 설명                      |
| 시작일시   | DateTime | X    | 만료일시보다 이전        | NULL   | 할일 시작 시간 (선택 입력, 만료일시와 함께 사용 시 시작일시 < 만료일시) |
| 만료일시   | DateTime | X    | 시작일시보다 이후        | NULL   | 할일 마감 기한 (사용자 참고용, 시스템 자동처리 안함, 만료 시 알림 없음) |
| 완료여부   | Boolean  | O    | TRUE, FALSE              | FALSE  | 할일 완료 상태 (사용자가 수동으로 완료 처리) |
| 완료일시   | DateTime | X    | -                        | NULL   | 할일 완료 시간 (완료 처리 시 자동 설정) |
| 상태       | Enum     | O    | ACTIVE, DELETED          | ACTIVE | 할일 생명주기 상태 (활성/삭제됨)    |
| 소유자     | UUID     | X    | FK(User), NULL 가능      | NULL   | 소유 사용자 ID (NULL=공통 할일)     |
| 유형       | Enum     | O    | PERSONAL, COMMON         | PERSONAL | 할일 유형 (개인 할일/공통 할일)     |
| 생성일시   | DateTime | O    | -                        | Now()  | 레코드 생성 시간                    |
| 수정일시   | DateTime | O    | -                        | Now()  | 레코드 최종 수정 시간               |

#### 참조 관계

- **참조**: User (소유자)
- **참조됨**: Trash

### 2.3 Trash (휴지통)

삭제된 개인 할일을 임시 보관하는 영역입니다.

#### 속성 정의

| 속성명     | 타입     | 필수 | 제약조건       | 기본값 | 설명                 |
| ---------- | -------- | ---- | -------------- | ------ | -------------------- |
| 휴지통ID   | UUID     | O    | PK, Unique     | Auto   | 휴지통 항목 고유 식별자 (시스템 자동 생성) |
| 할일ID     | UUID     | O    | FK(TodoItem), Unique | -  | 삭제된 할일 참조 (TodoItem과 1:1 관계) |
| 삭제일시   | DateTime | O    | -              | Now()  | 휴지통 이동 시간 (할일 삭제 시 자동 설정) |

**설계 노트**:
- Trash는 별도 엔티티이지만 TodoItem의 `상태=DELETED`와 연동하여 동작
- TodoItem 삭제 시: `TodoItem.상태=DELETED` 변경 + `Trash` 레코드 생성
- 복원 시: `TodoItem.상태=ACTIVE` 변경 + `Trash` 레코드 삭제
- 영구삭제 시: `TodoItem` 및 `Trash` 레코드 모두 물리적 삭제

#### 참조 관계

- **참조**: TodoItem

## 3. 주요 도메인 개념

### 3.1 할일 유형

- **개인 할일 (PERSONAL)**: 사용자가 직접 생성한 할일로, 모든 작업(수정/삭제/복원) 가능
- **공통 할일 (COMMON)**: 시스템에서 제공하는 국경일 등의 일정으로, 조회만 가능하며 삭제 불가

### 3.2 할일 생명주기 상태

할일의 생명주기는 `상태` 속성으로 관리되며, 물리적 존재 여부를 나타냅니다:

- **활성 (ACTIVE)**: 일반적인 할일 목록에 표시되는 상태
- **삭제됨 (DELETED)**: 휴지통으로 이동한 상태 (복원 가능)
- **영구삭제**: 휴지통에서도 삭제되어 복구 불가능한 상태 (물리적 삭제, DB에서 레코드 제거)

### 3.3 할일 완료 상태

할일의 완료 여부는 `완료여부` 속성으로 별도 관리되며, 생명주기 상태와 독립적입니다:

- **미완료 (FALSE)**: 할일이 아직 완료되지 않은 상태
- **완료 (TRUE)**: 사용자가 수동으로 완료 처리한 상태
- 완료 처리 시 `완료일시`가 자동으로 현재 시간으로 설정됨
- 만료일시가 지나도 자동으로 완료 처리되지 않음 (사용자 수동 처리 필요)
- 완료된 할일도 미완료로 되돌릴 수 있음 (완료일시는 NULL로 재설정)
- 삭제된 할일(DELETED 상태)도 완료 상태를 유지하며, 복원 시 완료 상태 그대로 복원됨

**상태 관리 설계 원칙**:
- `상태` (ACTIVE/DELETED): 할일의 물리적 위치와 가시성 제어
- `완료여부` (TRUE/FALSE): 할일의 논리적 완료 상태 표현
- 두 속성은 독립적으로 동작하여 "완료되었지만 삭제된 할일" 등의 조합 가능

## 4. 주요 비즈니스 규칙

### 4.1 인증 및 권한

#### 4.1.1 인증 필수

**규칙**: 회원가입하지 않은 사용자는 앱의 주요 기능을 이용할 수 없습니다.

**검증 조건**:
- 요청에 유효한 인증 토큰이 포함되어 있어야 함
- 토큰이 만료되지 않았어야 함

**실패 케이스**:
- 조건: 인증 토큰 없음 또는 유효하지 않음
- 출력: 401 Unauthorized 오류, "로그인이 필요합니다"

#### 4.1.2 자신의 할일만 접근 가능

**규칙**: 로그인한 사용자는 자신이 소유한 개인 할일만 조회/수정/삭제할 수 있습니다.

**검증 조건**:
- 개인 할일: `TodoItem.소유자 = 현재_로그인_사용자.ID`
- 공통 할일: 모든 사용자 조회 가능 (수정/삭제 불가)

**성공 케이스**:
- 입력: 사용자A가 자신의 할일ID 조회 요청
- 조건: `TodoItem.소유자 = 사용자A.ID`
- 출력: 할일 정보 반환

**실패 케이스**:
- 입력: 사용자A가 사용자B의 할일ID 수정 요청
- 조건: `TodoItem.소유자 = 사용자B.ID ≠ 사용자A.ID`
- 출력: 403 Forbidden 오류, "본인의 할일만 수정할 수 있습니다"

#### 4.1.3 공통 할일 읽기 전용

**규칙**: 공통 할일은 모든 사용자에게 읽기 전용으로 제공됩니다.

**검증 조건**:
- `TodoItem.유형 = COMMON`인 경우 수정/삭제 작업 차단

**실패 케이스**:
- 입력: 공통 할일 수정 또는 삭제 요청
- 조건: `TodoItem.유형 = COMMON`
- 출력: 400 Bad Request 오류, "공통 할일은 수정/삭제할 수 없습니다"

### 4.2 할일 생명주기

#### 4.2.1 할일 생성

**규칙**: 할일 생성 시 시작일시와 만료일시를 설정할 수 있습니다.

**검증 조건**:
- 제목은 필수 (1-200자)
- 시작일시 < 만료일시 (둘 다 입력된 경우)

**성공 케이스**:
- 입력: 제목="회의 준비", 시작일시=2025-11-26 09:00, 만료일시=2025-11-26 10:00
- 조건: 시작일시 < 만료일시
- 출력: 할일 생성 성공, 할일ID 반환

**실패 케이스**:
- 입력: 시작일시=2025-11-26 10:00, 만료일시=2025-11-26 09:00
- 조건: 시작일시 >= 만료일시
- 출력: 400 Bad Request 오류, "시작일시는 만료일시보다 이전이어야 합니다"

#### 4.2.2 할일 수정

**규칙**: 개인 할일은 내용, 시작일시, 만료일시를 수정할 수 있습니다.

**검증 조건**:
- `TodoItem.유형 = PERSONAL`
- `TodoItem.소유자 = 현재_로그인_사용자.ID`
- `TodoItem.상태 = ACTIVE`
- 수정 후에도 시작일시 < 만료일시

**성공 케이스**:
- 입력: 본인의 활성 개인 할일 수정 요청
- 조건: 모든 검증 조건 충족
- 출력: 할일 수정 성공, 수정일시 업데이트

**실패 케이스**:
- 입력: 삭제된 할일 수정 요청
- 조건: `TodoItem.상태 = DELETED`
- 출력: 400 Bad Request 오류, "삭제된 할일은 수정할 수 없습니다"

#### 4.2.3 할일 삭제 (휴지통 이동)

**규칙**: 개인 할일 삭제 시 즉시 삭제되지 않고 휴지통으로 이동합니다.

**검증 조건**:
- `TodoItem.유형 = PERSONAL`
- `TodoItem.소유자 = 현재_로그인_사용자.ID`
- `TodoItem.상태 = ACTIVE`

**프로세스**:
1. TodoItem.상태를 DELETED로 변경
2. Trash 레코드 생성 (할일ID, 삭제일시)

**성공 케이스**:
- 입력: 본인의 활성 개인 할일 삭제 요청
- 조건: 모든 검증 조건 충족
- 출력: 할일이 휴지통으로 이동, Trash 레코드 생성

**실패 케이스**:
- 입력: 공통 할일 삭제 요청
- 조건: `TodoItem.유형 = COMMON`
- 출력: 400 Bad Request 오류, "공통 할일은 삭제할 수 없습니다"

#### 4.2.4 할일 복원

**규칙**: 휴지통의 할일은 원복(복원) 가능합니다.

**검증 조건**:
- `TodoItem.상태 = DELETED`
- `TodoItem.소유자 = 현재_로그인_사용자.ID`
- Trash 레코드 존재

**프로세스**:
1. TodoItem.상태를 ACTIVE로 변경
2. Trash 레코드 삭제

**성공 케이스**:
- 입력: 본인의 휴지통 할일 복원 요청
- 조건: 모든 검증 조건 충족
- 출력: 할일이 활성 상태로 복원, Trash 레코드 삭제

#### 4.2.5 할일 영구 삭제

**규칙**: 휴지통의 할일은 영구 삭제 가능합니다 (복구 불가).

**검증 조건**:
- `TodoItem.상태 = DELETED`
- `TodoItem.소유자 = 현재_로그인_사용자.ID`
- Trash 레코드 존재

**프로세스**:
1. Trash 레코드 삭제
2. TodoItem 레코드 물리적 삭제

**성공 케이스**:
- 입력: 본인의 휴지통 할일 영구 삭제 요청
- 조건: 모든 검증 조건 충족
- 출력: 할일 및 Trash 레코드 영구 삭제

**실패 케이스**:
- 입력: 활성 상태의 할일 영구 삭제 요청
- 조건: `TodoItem.상태 = ACTIVE`
- 출력: 400 Bad Request 오류, "휴지통에 있는 할일만 영구 삭제할 수 있습니다"

#### 4.2.6 할일 완료 처리

**규칙**: 사용자는 할일을 완료 상태로 표시하거나 미완료로 되돌릴 수 있습니다.

**검증 조건**:
- `TodoItem.상태 = ACTIVE` (활성 상태의 할일만 완료 처리 가능)
- 개인 할일: `TodoItem.소유자 = 현재_로그인_사용자.ID`
- 공통 할일: 완료 처리 불가

**프로세스 (완료 처리)**:
1. `완료여부`를 TRUE로 변경
2. `완료일시`를 현재 시간으로 설정
3. `수정일시` 업데이트

**프로세스 (완료 취소)**:
1. `완료여부`를 FALSE로 변경
2. `완료일시`를 NULL로 설정
3. `수정일시` 업데이트

**성공 케이스**:
- 입력: 본인의 미완료 할일 완료 처리 요청
- 조건: `TodoItem.완료여부 = FALSE`, `TodoItem.소유자 = 현재_로그인_사용자.ID`
- 출력: 완료여부 = TRUE, 완료일시 = 현재시간

**실패 케이스**:
- 입력: 공통 할일 완료 처리 요청
- 조건: `TodoItem.유형 = COMMON`
- 출력: 400 Bad Request 오류, "공통 할일은 완료 처리할 수 없습니다"

### 4.3 공통 할일 관리

#### 4.3.1 공통 할일 등록

**규칙**: 공통 할일(국경일 등)은 시스템 관리자만 등록할 수 있습니다.

**검증 조건**:
- 요청자가 시스템 관리자 권한 보유
- `소유자 = NULL`, `유형 = COMMON`으로 생성

**프로세스**:
1. TodoItem 생성 시 `소유자 = NULL`, `유형 = COMMON` 설정
2. 제목, 시작일시, 만료일시 설정
3. `완료여부 = FALSE`, `상태 = ACTIVE`로 초기화

**성공 케이스**:
- 입력: 관리자가 "신정(1월 1일)" 공통 할일 등록
- 조건: 요청자 = 시스템 관리자
- 출력: 공통 할일 생성 성공, 모든 사용자에게 표시됨

#### 4.3.2 공통 할일 조회

**규칙**: 모든 로그인 사용자는 공통 할일을 조회할 수 있습니다.

**검증 조건**:
- 유효한 인증 토큰 보유
- `TodoItem.유형 = COMMON`, `TodoItem.상태 = ACTIVE`

**출력**:
- 사용자의 개인 할일 목록과 함께 공통 할일도 반환
- 공통 할일은 수정/삭제/완료 처리 불가 표시

### 4.4 제약사항

- 공통 할일 (`유형 = COMMON`)은 수정, 삭제, 완료 처리가 불가능 (조회만 가능)
- 공통 할일은 휴지통으로 이동할 수 없음
- 영구 삭제된 할일은 복구할 수 없음
- 시스템 관리자만 공통 할일을 등록/삭제할 수 있음 (일반 사용자 제외)

## 5. 주요 유스케이스

### 5.1 사용자 관리

- 회원가입
- 로그인
- 로그아웃

### 5.2 할일 관리

- 할일 목록 조회 (개인 할일 + 공통 할일, 완료/미완료 필터링 가능)
- 할일 추가 (개인 할일)
- 할일 수정 (개인 할일만)
- 할일 삭제 (개인 할일만, 휴지통으로 이동)
- 할일 완료 처리 (개인 할일만)
- 할일 완료 취소 (개인 할일만)

### 5.3 휴지통 관리

- 휴지통 목록 조회
- 할일 복원 (휴지통 → 활성)
- 할일 영구 삭제 (휴지통 → 영구삭제)

## 6. 도메인 용어집

| 용어       | 설명                                                    |
| ---------- | ------------------------------------------------------- |
| 개인 할일  | 사용자가 직접 생성하고 관리하는 할일                    |
| 공통 할일  | 시스템 관리자가 등록한 국경일 등의 공통 일정            |
| 휴지통     | 삭제된 개인 할일을 임시 보관하는 영역                   |
| 시작일시   | 할일의 계획된 시작 시간 (선택 입력, 참고용)             |
| 만료일시   | 할일의 목표 완료 시간 (참고용, 자동 처리 안함)          |
| 완료여부   | 할일의 완료 상태 (사용자 수동 처리)                     |
| 원복/복원  | 휴지통의 할일을 다시 활성 상태로 되돌리는 작업          |
| 영구삭제   | 복구 불가능하게 완전히 삭제하는 작업 (물리적 삭제)      |

---

## 7. 예외 상황 및 에러 처리

### 7.1 인증/권한 에러

| 에러 코드          | 상황                                  | 응답 메시지                          |
| ----------------- | ------------------------------------- | ----------------------------------- |
| 401 Unauthorized  | 인증 토큰 없음 또는 만료              | "로그인이 필요합니다"               |
| 403 Forbidden     | 타인의 할일 접근 시도                 | "본인의 할일만 접근할 수 있습니다"  |
| 403 Forbidden     | 공통 할일 수정/삭제 시도              | "공통 할일은 수정/삭제할 수 없습니다" |
| 403 Forbidden     | 관리자 권한 필요한 작업               | "관리자 권한이 필요합니다"          |

### 7.2 유효성 검증 에러

| 에러 코드         | 상황                                   | 응답 메시지                                |
| ---------------- | -------------------------------------- | ----------------------------------------- |
| 400 Bad Request  | 제목 미입력 또는 길이 초과             | "제목은 1-200자 이내로 입력해주세요"      |
| 400 Bad Request  | 내용 길이 초과                         | "내용은 2000자 이내로 입력해주세요"       |
| 400 Bad Request  | 시작일시 >= 만료일시                   | "시작일시는 만료일시보다 이전이어야 합니다" |
| 400 Bad Request  | 삭제된 할일 수정 시도                  | "삭제된 할일은 수정할 수 없습니다"         |
| 400 Bad Request  | 활성 할일 영구 삭제 시도               | "휴지통에 있는 할일만 영구 삭제할 수 있습니다" |
| 400 Bad Request  | 공통 할일 완료 처리 시도               | "공통 할일은 완료 처리할 수 없습니다"      |

### 7.3 리소스 에러

| 에러 코드        | 상황                                   | 응답 메시지                        |
| --------------- | -------------------------------------- | --------------------------------- |
| 404 Not Found   | 존재하지 않는 할일ID 조회              | "할일을 찾을 수 없습니다"         |
| 404 Not Found   | 존재하지 않는 사용자ID                 | "사용자를 찾을 수 없습니다"       |
| 409 Conflict    | 중복 이메일로 회원가입 시도            | "이미 사용 중인 이메일입니다"     |

### 7.4 시스템 에러

| 에러 코드                  | 상황                     | 응답 메시지                              |
| ------------------------- | ------------------------ | --------------------------------------- |
| 500 Internal Server Error | 데이터베이스 연결 실패   | "일시적인 오류가 발생했습니다"          |
| 500 Internal Server Error | 예상치 못한 시스템 오류  | "오류가 발생했습니다. 관리자에게 문의하세요" |

### 7.5 에러 처리 원칙

1. **명확한 에러 메시지**: 사용자가 이해할 수 있는 한글 메시지 제공
2. **보안 고려**: 시스템 내부 정보 노출 금지 (스택 트레이스, DB 정보 등)
3. **일관된 응답 형식**: 모든 에러는 동일한 JSON 구조로 반환
   ```json
   {
     "error": {
       "code": "400",
       "message": "제목은 1-200자 이내로 입력해주세요",
       "field": "제목"
     }
   }
   ```
4. **로깅**: 모든 에러는 서버 로그에 기록 (디버깅 및 모니터링용)

---

## 8. 테스트 시나리오

### 8.1 사용자 인증 테스트

#### TC-001: 회원가입 성공
**전제조건**: 없음
**입력**:
- 이메일: "test@example.com"
- 비밀번호: "password123"
- 이름: "홍길동"

**예상 결과**:
- 사용자 생성 성공
- 사용자ID 반환
- 비밀번호 암호화 저장 확인

**검증 방법**:
- DB에서 사용자 레코드 확인
- 비밀번호가 평문이 아닌 해시값인지 확인

#### TC-002: 중복 이메일 회원가입 실패
**전제조건**: 이메일 "test@example.com"으로 가입된 사용자 존재
**입력**: 이메일 "test@example.com"로 재가입 시도
**예상 결과**: 409 Conflict 오류, "이미 사용 중인 이메일입니다"

#### TC-003: 비로그인 사용자 접근 차단
**전제조건**: 인증 토큰 없음
**입력**: 할일 목록 조회 요청
**예상 결과**: 401 Unauthorized 오류, "로그인이 필요합니다"

### 8.2 할일 생성 테스트

#### TC-101: 개인 할일 생성 성공 (최소 입력)
**전제조건**: 사용자A 로그인 상태
**입력**:
- 제목: "회의 준비"
- 내용: NULL
- 시작일시: NULL
- 만료일시: NULL

**예상 결과**:
- 할일 생성 성공
- 소유자 = 사용자A.ID
- 유형 = PERSONAL
- 상태 = ACTIVE
- 완료여부 = FALSE

#### TC-102: 할일 생성 성공 (일시 포함)
**전제조건**: 사용자A 로그인 상태
**입력**:
- 제목: "프로젝트 마감"
- 시작일시: "2025-11-26 09:00:00"
- 만료일시: "2025-11-26 18:00:00"

**예상 결과**:
- 할일 생성 성공
- 시작일시 < 만료일시 확인

#### TC-103: 제목 유효성 검증 실패 (경계값 테스트)
**전제조건**: 사용자A 로그인 상태
**입력**:
- 제목: "" (빈 문자열)

**예상 결과**: 400 Bad Request 오류, "제목은 1-200자 이내로 입력해주세요"

**추가 경계값 테스트**:
- 제목 1자: 성공
- 제목 200자: 성공
- 제목 201자: 실패
- 내용 2000자: 성공
- 내용 2001자: 실패

#### TC-104: 일시 검증 실패
**전제조건**: 사용자A 로그인 상태
**입력**:
- 시작일시: "2025-11-26 18:00:00"
- 만료일시: "2025-11-26 09:00:00" (시작일시보다 이전)

**예상 결과**: 400 Bad Request 오류, "시작일시는 만료일시보다 이전이어야 합니다"

### 8.3 할일 권한 테스트

#### TC-201: 본인 할일 조회 성공
**전제조건**: 사용자A가 생성한 할일ID=1 존재
**입력**: 사용자A로 할일ID=1 조회
**예상 결과**: 할일 정보 반환

#### TC-202: 타인 할일 조회 실패
**전제조건**: 사용자B가 생성한 할일ID=2 존재
**입력**: 사용자A로 할일ID=2 조회
**예상 결과**: 403 Forbidden 오류, "본인의 할일만 접근할 수 있습니다"

#### TC-203: 공통 할일 조회 성공
**전제조건**: 공통 할일ID=100 (신정) 존재
**입력**: 사용자A로 할일ID=100 조회
**예상 결과**: 할일 정보 반환 (모든 사용자 조회 가능)

#### TC-204: 공통 할일 수정 실패
**전제조건**: 공통 할일ID=100 존재
**입력**: 사용자A로 할일ID=100 수정 시도
**예상 결과**: 403 Forbidden 오류, "공통 할일은 수정/삭제할 수 없습니다"

### 8.4 할일 생명주기 테스트

#### TC-301: 할일 삭제 → 휴지통 이동
**전제조건**: 사용자A의 활성 할일ID=1 존재
**입력**: 할일ID=1 삭제 요청
**예상 결과**:
- TodoItem.상태 = DELETED
- Trash 레코드 생성 (할일ID=1, 삭제일시=현재시간)
- 할일 목록 조회 시 표시 안됨
- 휴지통 목록 조회 시 표시됨

#### TC-302: 휴지통 할일 복원
**전제조건**: 할일ID=1이 휴지통에 존재
**입력**: 할일ID=1 복원 요청
**예상 결과**:
- TodoItem.상태 = ACTIVE
- Trash 레코드 삭제
- 할일 목록 조회 시 표시됨

#### TC-303: 휴지통 할일 영구 삭제
**전제조건**: 할일ID=1이 휴지통에 존재
**입력**: 할일ID=1 영구 삭제 요청
**예상 결과**:
- TodoItem 레코드 물리적 삭제
- Trash 레코드 삭제
- DB에서 완전히 제거 확인

#### TC-304: 활성 할일 영구 삭제 시도 실패
**전제조건**: 사용자A의 활성 할일ID=1 존재
**입력**: 할일ID=1 영구 삭제 요청
**예상 결과**: 400 Bad Request 오류, "휴지통에 있는 할일만 영구 삭제할 수 있습니다"

### 8.5 할일 완료 테스트

#### TC-401: 할일 완료 처리
**전제조건**: 사용자A의 미완료 할일ID=1 존재
**입력**: 할일ID=1 완료 처리
**예상 결과**:
- 완료여부 = TRUE
- 완료일시 = 현재시간
- 수정일시 업데이트

#### TC-402: 완료 취소
**전제조건**: 사용자A의 완료된 할일ID=1 존재
**입력**: 할일ID=1 완료 취소
**예상 결과**:
- 완료여부 = FALSE
- 완료일시 = NULL
- 수정일시 업데이트

#### TC-403: 공통 할일 완료 처리 실패
**전제조건**: 공통 할일ID=100 존재
**입력**: 할일ID=100 완료 처리 시도
**예상 결과**: 400 Bad Request 오류, "공통 할일은 완료 처리할 수 없습니다"

#### TC-404: 삭제된 할일도 완료 상태 유지
**전제조건**: 사용자A의 완료된 할일ID=1 (완료여부=TRUE)
**입력**: 할일ID=1 삭제
**예상 결과**:
- 상태 = DELETED
- 완료여부 = TRUE (유지)
- 완료일시 유지

**추가 검증**: 복원 시 완료 상태 그대로 복원됨

### 8.6 공통 할일 관리 테스트

#### TC-501: 시스템 관리자 공통 할일 등록
**전제조건**: 시스템 관리자 로그인
**입력**:
- 제목: "신정"
- 시작일시: "2026-01-01 00:00:00"
- 만료일시: "2026-01-01 23:59:59"
- 유형: COMMON

**예상 결과**:
- 할일 생성 성공
- 소유자 = NULL
- 모든 사용자의 할일 목록에 표시됨

#### TC-502: 일반 사용자 공통 할일 등록 실패
**전제조건**: 일반 사용자A 로그인
**입력**: 공통 할일 등록 시도
**예상 결과**: 403 Forbidden 오류, "관리자 권한이 필요합니다"

### 8.7 경계값 및 엣지 케이스 테스트

#### TC-601: 만료일시 경과 후에도 자동 완료 안됨
**전제조건**: 사용자A의 할일 (만료일시="2025-11-20 18:00:00")
**현재시간**: 2025-11-25 10:00:00
**예상 결과**: 만료일시가 지났지만 완료여부=FALSE 유지

#### TC-602: 시작일시만 입력 (만료일시 없음)
**전제조건**: 사용자A 로그인
**입력**: 시작일시만 입력, 만료일시 NULL
**예상 결과**: 할일 생성 성공

#### TC-603: 만료일시만 입력 (시작일시 없음)
**전제조건**: 사용자A 로그인
**입력**: 만료일시만 입력, 시작일시 NULL
**예상 결과**: 할일 생성 성공

#### TC-604: 동일 시작/만료일시
**전제조건**: 사용자A 로그인
**입력**: 시작일시 = 만료일시
**예상 결과**: 400 Bad Request 오류 (시작일시 < 만료일시 조건 위반)

---

## 9. 관련 문서

### 9.1 참조 문서

| 문서명 | 설명 | 위치 | 상태 |
|--------|------|------|------|
| 요구사항 정의서 | 초기 프로젝트 요구사항 및 기능 정의 | `docs/0-domain-definition-request.md` | 완료 |
| 도메인 정의 평가서 | 도메인 정의서 품질 평가 결과 | `docs/2-domain-definition-evaluation.md` | 완료 |
| API 명세서 | RESTful API 엔드포인트 정의 | `docs/api-specification.md` | 작성 예정 |
| 데이터베이스 스키마 | ERD 및 테이블 정의 | `docs/database-schema.md` | 작성 예정 |
| 인증/인가 설계서 | JWT 토큰 기반 인증 구현 상세 | `docs/authentication-design.md` | 작성 예정 |
| 테스트 계획서 | 통합/단위 테스트 계획 | `docs/test-plan.md` | 작성 예정 |
| 배포 가이드 | 프로덕션 배포 절차 | `docs/deployment-guide.md` | 작성 예정 |

### 9.2 엔티티 의존 관계 맵

```
User (사용자)
  └─> 참조됨: TodoItem.소유자 (1:N 관계)
      - User 삭제 시: 소유한 TodoItem 처리 방안 필요 (Cascade Delete 또는 소유자=NULL 전환)
      - 관련 규칙: 4.1.2 (자신의 할일만 접근 가능)

TodoItem (할일)
  ├─> 참조: User.사용자ID (소유자) - 개인 할일의 경우
  │   - NULL 가능: 공통 할일은 소유자 없음
  │   - 관련 규칙: 4.1.2, 4.2.1, 4.2.2
  │
  └─> 참조됨: Trash.할일ID (1:1 관계)
      - TodoItem 상태=DELETED일 때만 Trash 레코드 존재
      - 관련 규칙: 4.2.3, 4.2.4, 4.2.5

Trash (휴지통)
  └─> 참조: TodoItem.할일ID (1:1 관계)
      - Trash 생성 시 TodoItem 반드시 존재
      - TodoItem 영구삭제 시 함께 삭제됨
      - 관련 규칙: 4.2.3, 4.2.4, 4.2.5
```

### 9.3 비즈니스 규칙-엔티티 매핑

| 비즈니스 규칙 | 관련 엔티티 | 영향받는 속성 |
|---------------|------------|--------------|
| 4.1.1 인증 필수 | User | 사용자ID, 인증토큰(외부) |
| 4.1.2 자신의 할일만 접근 | User, TodoItem | TodoItem.소유자 |
| 4.1.3 공통 할일 읽기 전용 | TodoItem | TodoItem.유형 |
| 4.2.1 할일 생성 | TodoItem, User | TodoItem.*, User.사용자ID |
| 4.2.2 할일 수정 | TodoItem | TodoItem.제목, 내용, 시작일시, 만료일시, 수정일시 |
| 4.2.3 할일 삭제 | TodoItem, Trash | TodoItem.상태, Trash.* |
| 4.2.4 할일 복원 | TodoItem, Trash | TodoItem.상태 |
| 4.2.5 할일 영구삭제 | TodoItem, Trash | 전체 레코드 삭제 |
| 4.2.6 할일 완료 처리 | TodoItem | TodoItem.완료여부, 완료일시, 수정일시 |
| 4.3.1 공통 할일 등록 | TodoItem | TodoItem.유형, 소유자 |
| 4.3.2 공통 할일 조회 | TodoItem | TodoItem.유형, 상태 |

### 9.4 향후 확장 고려사항

#### 단기 확장 (v2.0)
- **할일 카테고리**: 업무, 개인, 건강 등 카테고리 분류
- **할일 우선순위**: 높음, 보통, 낮음 우선순위 설정
- **반복 할일**: 매일, 매주 등 반복 일정 지원
- **할일 알림**: 만료일시 기반 푸시 알림

#### 중기 확장 (v3.0)
- **할일 공유**: 특정 사용자와 할일 공유 기능
- **팀 할일**: 팀 단위 할일 관리
- **할일 검색**: 제목, 내용 기반 전문 검색
- **통계 대시보드**: 완료율, 생산성 분석

#### 장기 확장 (v4.0)
- **AI 추천**: 할일 우선순위 자동 제안
- **캘린더 연동**: Google Calendar, Outlook 연동
- **모바일 앱**: iOS, Android 네이티브 앱

**확장 시 고려사항**:
- 엔티티 추가보다는 기존 엔티티 확장 우선 (하위 호환성 유지)
- 새로운 속성 추가 시 기본값 제공 (기존 데이터 영향 최소화)
- API 버전 관리 (v1, v2 병행 운영)

### 9.5 용어 변경 이력

| 구 용어 | 신 용어 | 변경 사유 | 버전 |
|--------|--------|----------|------|
| 상태 (단일 의미) | 생명주기 상태 + 완료여부 | 할일 완료 개념 추가로 상태 속성 분리 | 1.1 |
| - | 완료일시 | 할일 완료 시간 추적 필요 | 1.1 |

---

## 10. 요구사항 추적 매트릭스

| 요구사항 ID | 요구사항 내용 | 도메인 요소 | 비즈니스 규칙 | 우선순위 |
|------------|--------------|------------|--------------|---------|
| REQ-001 | 사용자별 할일 관리 | User, TodoItem.소유자 | 4.1.2 | Must |
| REQ-002 | 할일 만료 기한 표현 | TodoItem.시작일시, 만료일시 | 4.2.1 | Must |
| REQ-003 | 국경일 관리 | TodoItem.유형=COMMON | 4.3.1, 4.3.2 | Must |
| REQ-004 | 회원가입/로그인 | User | 4.1.1 | Must |
| REQ-005 | 할일 조회 | TodoItem | 4.1.2 | Must |
| REQ-006 | 할일 추가 | TodoItem | 4.2.1 | Must |
| REQ-007 | 할일 수정 | TodoItem | 4.2.2 | Must |
| REQ-008 | 할일 삭제 (휴지통) | TodoItem, Trash | 4.2.3 | Must |
| REQ-009 | 할일 복원 | TodoItem, Trash | 4.2.4 | Must |
| REQ-010 | 할일 영구삭제 | TodoItem, Trash | 4.2.5 | Must |
| REQ-011 | 공통 할일 삭제 불가 | TodoItem.유형 | 4.4 | Must |
| REQ-012 | 할일 완료 처리 | TodoItem.완료여부, 완료일시 | 4.2.6 | Should |
| REQ-013 | 공통 할일 시스템 관리 | TodoItem | 4.3.1 | Should |

**우선순위 정의**:
- **Must**: 필수 요구사항, 없으면 시스템 동작 불가
- **Should**: 중요 요구사항, 사용성에 큰 영향
- **Could**: 선택적 요구사항, 있으면 좋음
- **Won't**: 현재 버전에서 제외
